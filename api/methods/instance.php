<?php $route = '/certification/';$app->get($route, function ()  use ($app){	$ReturnObject = array(); 	$request = $app->request();  	$params = $request->params();		if(isset($params['query'])){ $query = trim(mysql_real_escape_string($params['query'])); } else { $query = '';}	if(isset($params['page'])){ $page = trim(mysql_real_escape_string($params['page'])); } else { $page = 0;}	if(isset($params['count'])){ $count = trim(mysql_real_escape_string($params['count'])); } else { $count = 250;}	if(isset($params['sort'])){ $sort = trim(mysql_real_escape_string($params['sort'])); } else { $sort = 'Title';}	if(isset($params['order'])){ $order = trim(mysql_real_escape_string($params['order'])); } else { $order = 'DESC';}					// Pull from MySQL	if($query!='')		{		$Query = "SELECT * FROM certification WHERE Title LIKE '%" . $query . "%'";		}	else 		{
		$Query = "SELECT * FROM certification";		
		}	$Query .= " ORDER BY " . $sort . " " . $order . " LIMIT " . $page . "," . $count;	//echo $Query . "<br />";		$DatabaseResult = mysql_query($Query) or die('Query failed: ' . mysql_error());	  	while ($Database = mysql_fetch_assoc($DatabaseResult))		{					$certification_id = $Database['ID'];		$post_date = $Database['Post_Date'];		$title = $Database['Title'];		$author = $Database['Author'];		$summary = $Database['Summary'];		$body = $Database['Body'];		$footer = $Database['Footer'];		$status = $Database['Status'];		$buildpage = $Database['Build_Page'];		$showonsite = $Database['Show_On_Site'];		$image = $Database['Feature_Image'];				$curated_id = $Database['News_ID'];								// manipulation zone				$F = array();		$F['certification_id'] = $certification_id;		$F['post_date'] = $post_date;		$F['title'] = $title;		$F['author'] = $author;		$F['summary'] = $summary;		$F['body'] = $body;		$F['footer'] = $footer;		$F['status'] = $status;		$F['image'] = $image;		$F['build_page'] = $buildpage;		$F['show_on_site'] = $showonsite;		$F['curated_id'] = $curated_id;				array_push($ReturnObject, $F);		}		$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($ReturnObject));	});	$route = '/certification/published/';$app->get($route, function ()  use ($app){	$ReturnObject = array(); 	$request = $app->request();  	$params = $request->params();		if(isset($params['query'])){ $query = trim(mysql_real_escape_string($params['query'])); } else { $query = '';}	if(isset($params['page'])){ $page = trim(mysql_real_escape_string($params['page'])); } else { $page = 0;}	if(isset($params['count'])){ $count = trim(mysql_real_escape_string($params['count'])); } else { $count = 250;}	if(isset($params['sort'])){ $sort = trim(mysql_real_escape_string($params['sort'])); } else { $sort = 'Title';}	if(isset($params['order'])){ $order = trim(mysql_real_escape_string($params['order'])); } else { $order = 'DESC';}					// Pull from MySQL	if($query!='')		{		$Query = "SELECT * FROM certification WHERE Show_On_Site = 1 AND  Title LIKE '%" . $query . "%'";		}	else 		{		$Query = "SELECT * FROM certification WHERE Show_On_Site = 1";				}	$Query .= " ORDER BY " . $sort . " " . $order . " LIMIT " . $page . "," . $count;	//echo $Query . "<br />";		$DatabaseResult = mysql_query($Query) or die('Query failed: ' . mysql_error());	  	while ($Database = mysql_fetch_assoc($DatabaseResult))		{					$certification_id = $Database['ID'];		$post_date = $Database['Post_Date'];		$title = $Database['Title'];		$author = $Database['Author'];		$summary = $Database['Summary'];		$body = $Database['Body'];		$footer = $Database['Footer'];		$status = $Database['Status'];		$buildpage = $Database['Build_Page'];		$showonsite = $Database['Show_On_Site'];		$image = $Database['Feature_Image'];				$curated_id = $Database['News_ID'];								// manipulation zone				$F = array();		$F['certification_id'] = $certification_id;		$F['post_date'] = $post_date;		$F['title'] = $title;		$F['author'] = $author;		$F['summary'] = $summary;		$F['body'] = $body;		$F['footer'] = $footer;		$F['status'] = $status;		$F['image'] = $image;		$F['build_page'] = $buildpage;		$F['show_on_site'] = $showonsite;		$F['curated_id'] = $curated_id;				array_push($ReturnObject, $F);		}		$app->response()->header("Content-Type", "application/json");		echo stripslashes(format_json(json_encode($ReturnObject)));	});		$route = '/certification/draft/';$app->get($route, function ()  use ($app){	$ReturnObject = array(); 	$request = $app->request();  	$params = $request->params();		if(isset($params['query'])){ $query = trim(mysql_real_escape_string($params['query'])); } else { $query = '';}	if(isset($params['page'])){ $page = trim(mysql_real_escape_string($params['page'])); } else { $page = 0;}	if(isset($params['count'])){ $count = trim(mysql_real_escape_string($params['count'])); } else { $count = 250;}	if(isset($params['sort'])){ $sort = trim(mysql_real_escape_string($params['sort'])); } else { $sort = 'Title';}	if(isset($params['order'])){ $order = trim(mysql_real_escape_string($params['order'])); } else { $order = 'DESC';}					// Pull from MySQL	if($query!='')		{		$Query = "SELECT * FROM certification WHERE Show_On_Site = 0 AND  Title LIKE '%" . $query . "%'";		}	else 		{		$Query = "SELECT * FROM certification WHERE Show_On_Site = 0";				}	$Query .= " ORDER BY " . $sort . " " . $order . " LIMIT " . $page . "," . $count;	//echo $Query . "<br />";		$DatabaseResult = mysql_query($Query) or die('Query failed: ' . mysql_error());	  	while ($Database = mysql_fetch_assoc($DatabaseResult))		{					$certification_id = $Database['ID'];		$post_date = $Database['Post_Date'];		$title = $Database['Title'];		$author = $Database['Author'];		$summary = $Database['Summary'];		$body = $Database['Body'];		$footer = $Database['Footer'];		$status = $Database['Status'];		$buildpage = $Database['Build_Page'];		$showonsite = $Database['Show_On_Site'];		$image = $Database['Feature_Image'];				$curated_id = $Database['News_ID'];								// manipulation zone				$F = array();		$F['certification_id'] = $certification_id;		$F['post_date'] = $post_date;		$F['title'] = $title;		$F['author'] = $author;		$F['summary'] = $summary;		$F['body'] = $body;		$F['footer'] = $footer;		$F['status'] = $status;		$F['image'] = $image;		$F['build_page'] = $buildpage;		$F['show_on_site'] = $showonsite;		$F['curated_id'] = $curated_id;				array_push($ReturnObject, $F);		}		$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($ReturnObject));	});			$route = '/certification/';	$app->post($route, function () use ($app){		$Add = 1;	$ReturnObject = array();	 	$request = $app->request();  	$params = $request->params();			if(isset($params['post_date'])){ $post_date = mysql_real_escape_string($params['post_date']); } else { $post_date = date('Y-m-d H:i:s'); }	if(isset($params['title'])){ $title = mysql_real_escape_string($params['title']); } else { $title = 'No Title'; }	if(isset($params['author'])){ $author = mysql_real_escape_string($params['author']); } else { $author = ''; }	if(isset($params['summary'])){ $summary = mysql_real_escape_string($params['summary']); } else { $summary = ''; }	if(isset($params['body'])){ $body = mysql_real_escape_string($params['body']); } else { $body = ''; }	if(isset($params['footer'])){ $footer = mysql_real_escape_string($params['footer']); } else { $footer = ''; }	if(isset($params['curated_id'])){ $curated_id = mysql_real_escape_string($params['curated_id']); } else { $curated_id = 0; }  	$Query = "SELECT * FROM certification WHERE Title = '" . $title . "' AND Author = '" . $author . "'";	//echo $Query . "<br />";	$Database = mysql_query($Query) or die('Query failed: ' . mysql_error());		if($Database && mysql_num_rows($Database))		{			$ThisCertification = mysql_fetch_assoc($Database);			$certification_id = $ThisCertification['ID'];		}	else 		{		$Query = "INSERT INTO certification(Post_Date,Title,Author,Summary,Body,Footer,News_ID)";		$Query .= " VALUES(";		$Query .= "'" . mysql_real_escape_string($post_date) . "',";		$Query .= "'" . mysql_real_escape_string($title) . "',";		$Query .= "'" . mysql_real_escape_string($author) . "',";		$Query .= "'" . mysql_real_escape_string($summary) . "',";		$Query .= "'" . mysql_real_escape_string($body) . "',";		$Query .= "'" . mysql_real_escape_string($footer) . "',";		$Query .= mysql_real_escape_string($curated_id);		$Query .= ")";		//echo $Query . "<br />";		mysql_query($Query) or die('Query failed: ' . mysql_error());		$certification_id = mysql_insert_id();					}	$ReturnObject['certification_id'] = $certification_id;		$app->response()->header("Content-Type", "application/json");	echo format_json(json_encode($ReturnObject));	});	$route = '/certification/tags/';$app->get($route, function ()  use ($app){	$ReturnObject = array();	 	$request = $app->request();  	$params = $request->params();		$Query = "SELECT t.Tag_ID, t.Tag, count(*) AS API_Count from tags t";	$Query .= " INNER JOIN certification_tag_pivot btp ON t.Tag_ID = btp.Tag_ID";	$Query .= " GROUP BY t.Tag ORDER BY count(*) DESC";	$DatabaseResult = mysql_query($Query) or die('Query failed: ' . mysql_error());	  	while ($Database = mysql_fetch_assoc($DatabaseResult))		{		$tag_id = $Database['Tag_ID'];		$tag = $Database['Tag'];		$certification_count = $Database['Certification_Count'];		$F = array();		$F['tag_id'] = $tag_id;		$F['tag'] = $tag;		$F['certification_count'] = $certification_count;				array_push($ReturnObject, $F);		}		$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($ReturnObject));	});		$route = '/certification/tags/byweek/';$app->get($route, function ()  use ($app){	$ReturnObject = array();	 	$request = $app->request();  	$params = $request->params();		if(isset($_REQUEST['week'])){ $week = $params['week']; } else { $week = date('W'); }	if(isset($_REQUEST['year'])){ $year = $params['year']; } else { $year = date('Y'); }	$Query = "SELECT t.Tag_ID, t.Tag, count(*) AS Certification_Count from tags t";	$Query .= " JOIN certification_tag_pivot btp ON t.Tag_ID = btp.Tag_ID";	$Query .= " JOIN certification b ON btp.Certification_ID = b.ID";	$Query .= " WHERE WEEK(b.Post_Date) = " . $week . " AND YEAR(b.Post_Date) = " . $year;	$Query .= " GROUP BY t.Tag ORDER BY count(*) DESC";	$DatabaseResult = mysql_query($Query) or die('Query failed: ' . mysql_error());	  	while ($Database = mysql_fetch_assoc($DatabaseResult))		{		$tag_id = $Database['Tag_ID'];		$tag = $Database['Tag'];		$certification_count = $Database['Certification_Count'];		$F = array();		$F['tag_id'] = $tag_id;		$F['tag'] = $tag;		$F['certification_count'] = $certification_count;				array_push($ReturnObject, $F);		}		$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($ReturnObject));	});			$route = '/certification/tags/:tag';$app->delete($route, function ($tag)  use ($app){	$ReturnObject = array();	 	$request = $app->request();  	$params = $request->params();		$Query = "SELECT t.Tag_ID, t.Tag FROM tags WHERE Tag = '" . trim(mysql_real_escape_string($tag)) . "'";	$TagResult = mysql_query($LinkQuery) or die('Query failed: ' . mysql_error());			if($TagResult && mysql_num_rows($TagResult))		{			$Tag = mysql_fetch_assoc($TagResult);		$Tag_ID = $Tag['Tag_ID'];		$Tag_Text = $Tag['Tag'];		$DeleteQuery = "DELETE FROM certification_tag_pivot WHERE Tag_ID = " . $Tag_ID;		$DeleteResult = mysql_query($DeleteQuery) or die('Query failed: ' . mysql_error());					$F = array();		$F['tag_id'] = $Tag_ID;		$F['tag'] = $Tag_Text;		$F['certification_count'] = 0;				array_push($ReturnObject, $F);		}		$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($ReturnObject));	});				$route = '/certification/tags/:tag/certification/';$app->get($route, function ($tag)  use ($app){	$ReturnObject = array();	 	$request = $app->request();  	$params = $request->params();			if(isset($_REQUEST['week'])){ $week = $params['week']; } else { $week = date('W'); }	if(isset($_REQUEST['year'])){ $year = $params['year']; } else { $year = date('Y'); }		$Query = "SELECT b.* from tags t";	$Query .= " JOIN certification_tag_pivot btp ON t.Tag_ID = btp.Tag_ID";	$Query .= " JOIN certification b ON btp.Certification_ID = b.ID";	$Query .= " WHERE WEEK(b.Post_Date) = " . $week . " AND YEAR(b.Post_Date) = " . $year . " AND Tag = '" . $tag . "'";	$DatabaseResult = mysql_query($Query) or die('Query failed: ' . mysql_error());	  	while ($Database = mysql_fetch_assoc($DatabaseResult))		{					$certification_id = $Database['ID'];		$post_date = $Database['Post_Date'];		$title = $Database['Title'];		$author = $Database['Author'];		$summary = $Database['Summary'];		$body = $Database['Body'];		$footer = $Database['Footer'];		$status = $Database['Status'];		$curated_id = $Database['News_ID'];								// manipulation zone				$F = array();		$F['certification_id'] = $certification_id;		$F['post_date'] = $post_date;		$F['title'] = $title;		$F['author'] = $author;		$F['summary'] = $summary;		$F['body'] = $body;		$F['footer'] = $footer;		$F['status'] = $status;		$F['curated_id'] = $curated_id;				array_push($ReturnObject, $F);		}		$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($ReturnObject));	});			$route = '/certification/:certification_id/';$app->get($route, function ($certification_id)  use ($app){	$ReturnObject = array();			$Query = "SELECT * FROM certification WHERE ID = " . $certification_id;		$DatabaseResult = mysql_query($Query) or die('Query failed: ' . mysql_error());	  	while ($Database = mysql_fetch_assoc($DatabaseResult))		{								$certification_id = $Database['ID'];		$post_date = $Database['Post_Date'];		$title = $Database['Title'];		$author = $Database['Author'];		$summary = $Database['Summary'];		$body = $Database['Body'];		$footer = $Database['Footer'];		$status = $Database['Status'];		$buildpage = $Database['Build_Page'];		$showonsite = $Database['Show_On_Site'];		$image = $Database['Feature_Image'];				$curated_id = $Database['News_ID'];								// manipulation zone				$F = array();		$F['certification_id'] = $certification_id;		$F['post_date'] = $post_date;		$F['title'] = $title;		$F['author'] = $author;		$F['summary'] = $summary;		$F['body'] = $body;		$F['footer'] = $footer;		$F['status'] = $status;		$F['image'] = $image;		$F['build_page'] = $buildpage;		$F['show_on_site'] = $showonsite;		$F['curated_id'] = $curated_id;				$ReturnObject = $F;		}		$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($ReturnObject));	});		$route = '/certification/:certification_id/tags/:tag/';$app->delete($route, function ($certification_id,$tag)  use ($app){	$ReturnObject = array();		 	$request = $app->request();  	$param = $request->params();			if($tag != '')		{			$certification_id = trim(mysql_real_escape_string($certification_id));		$tag = trim(mysql_real_escape_string($tag));			$CheckTagQuery = "SELECT Tag_ID FROM tags where Tag = '" . $tag . "'";		$CheckTagResults = mysql_query($CheckTagQuery) or die('Query failed: ' . mysql_error());				if($CheckTagResults && mysql_num_rows($CheckTagResults))			{			$Tag = mysql_fetch_assoc($CheckTagResults);					$tag_id = $Tag['Tag_ID'];			$DeleteQuery = "DELETE FROM certification_tag_pivot where Tag_ID = " . trim($tag_id) . " AND Certification_ID = " . trim($certification_id);			$DeleteResult = mysql_query($DeleteQuery) or die('Query failed: ' . mysql_error());			}		$F = array();		$F['tag_id'] = $tag_id;		$F['tag'] = $tag;		$F['certification_count'] = 0;				array_push($ReturnObject, $F);		}				$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($ReturnObject));	});			$route = '/certification/:certification_id/tags/';$app->get($route, function ($certification_id)  use ($app){	$ReturnObject = array();		 	$request = $app->request();  	$param = $request->params();			$Query = "SELECT t.Tag_ID, t.Tag FROM tags t";	$Query .= " JOIN certification_tag_pivot btp ON t.Tag_ID = btp.Tag_ID";	$Query .= " WHERE btp.Certification_ID = " . $certification_id;	$DatabaseResult = mysql_query($Query) or die('Query failed: ' . mysql_error());			while ($Database = mysql_fetch_assoc($DatabaseResult))		{					$Tag_ID = $Database['Tag_ID'];		$Tag_Text = $Database['Tag'];		$F = array();		$F['tag_id'] = $Tag_ID;		$F['tag'] = $Tag_Text;				array_push($ReturnObject, $F);		}		$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($ReturnObject));	});					$route = '/certification/:certification_id/tags/';$app->post($route, function ($Certification_ID)  use ($app){	$ReturnObject = array();		 	$request = $app->request();  	$param = $request->params();			if(isset($param['tag']))		{		$tag = trim(mysql_real_escape_string($param['tag']));					$CheckTagQuery = "SELECT Tag_ID FROM tags where Tag = '" . $tag . "'";		$CheckTagResults = mysql_query($CheckTagQuery) or die('Query failed: ' . mysql_error());				if($CheckTagResults && mysql_num_rows($CheckTagResults))			{			$Tag = mysql_fetch_assoc($CheckTagResults);					$Tag_ID = $Tag['Tag_ID'];			}		else			{			$query = "INSERT INTO tags(Tag) VALUES('" . trim($_POST['Tag']) . "'); ";			mysql_query($query) or die('Query failed: ' . mysql_error());				$Tag_ID = mysql_insert_id();						}		$CheckTagPivotQuery = "SELECT * FROM certification_tag_pivot where Tag_ID = " . trim($Tag_ID) . " AND Certification_ID = " . trim($Certification_ID);		$CheckTagPivotResult = mysql_query($CheckTagPivotQuery) or die('Query failed: ' . mysql_error());				if($CheckTagPivotResult && mysql_num_rows($CheckTagPivotResult))			{			$CheckTagPivot = mysql_fetch_assoc($CheckTagPivotResult);					}		else			{			$query = "INSERT INTO certification_tag_pivot(Tag_ID,Certification_ID) VALUES(" . $Tag_ID . "," . $Certification_ID . "); ";			mysql_query($query) or die('Query failed: ' . mysql_error());								}		$F = array();		$F['tag_id'] = $Tag_ID;		$F['tag'] = $tag;		$F['certification_count'] = 0;				array_push($ReturnObject, $F);		}				$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($ReturnObject));	});				$route = '/certification/:certification_id/';	$app->put($route, function ($certification_id) use ($app){			$ReturnObject = array();	 	$request = $app->request();  	$params = $request->params();			if(isset($params['post_date'])){ $post_date = mysql_real_escape_string($params['post_date']); } else { $post_date = date('Y-m-d H:i:s'); }	if(isset($params['title'])){ $title = mysql_real_escape_string($params['title']); } else { $title = 'No Title'; }	if(isset($params['author'])){ $author = mysql_real_escape_string($params['author']); } else { $author = ''; }	if(isset($params['summary'])){ $summary = mysql_real_escape_string($params['summary']); } else { $summary = ''; }	if(isset($params['body'])){ $body = mysql_real_escape_string($params['body']); } else { $body = ''; }	if(isset($params['footer'])){ $footer = mysql_real_escape_string($params['footer']); } else { $footer = ''; }	if(isset($params['curated_id'])){ $curated_id = mysql_real_escape_string($params['curated_id']); } else { $curated_id = 0; }  	$Query = "SELECT * FROM certification WHERE ID = " . $certification_id;	//echo $Query . "<br />";	$Database = mysql_query($Query) or die('Query failed: ' . mysql_error());		if($Database && mysql_num_rows($Database))		{			$query = "UPDATE certification SET";		$query .= " Title = '" . mysql_real_escape_string($title) . "'";		$query .= ", Post_Date = '" . mysql_real_escape_string($post_date) . "'";				if($post_date!='') { $query .= ", description = '" . $post_date . "'"; }		if($author!='') { $query .= ", Author = '" . $author . "'"; }		if($summary!='') { $query .= ", Summary = '" . $summary . "'"; }		if($body!='') { $query .= ", Body = '" . $body . "'"; }		if($footer!='') { $query .= ", Footer = '" . $footer . "'"; }		if($curated_id!='') { $query .= ", News_ID = '" . $curated_id . "'"; }				$query .= " WHERE certification_id = '" . $certification_id . "'";				//echo $query . "<br />";		mysql_query($query) or die('Query failed: ' . mysql_error());			}	$F = array();	$F['certification_id'] = $certification_id;	$F['post_date'] = $post_date;	$F['title'] = $title;	$F['author'] = $author;	$F['summary'] = $summary;	$F['body'] = $body;	$F['footer'] = $footer;	$F['curated_id'] = $curated_id;		array_push($ReturnObject, $F);			$app->response()->header("Content-Type", "application/json");	echo stripslashes(format_json(json_encode($ReturnObject)));	});	$route = '/certification/:certification_id/';	$app->delete($route, function ($certification_id) use ($app){		$Add = 1;	$ReturnObject = array();	 	$request = $app->request();  	$_POST = $request->params();		$query = "DELETE FROM certification WHERE ID = " . $certification_id;	//echo $query . "<br />";	mysql_query($query) or die('Query failed: ' . mysql_error());		});				?>